use role transformer_dev;
use database dev_db;
use schema dbt_tomiasikainenkaitofi;

1:
select count(distinct user_id)
from dev_db.dbt_tomiasikainenkaitofi.stg_postgres__users;
--result:130

2:
select avg(orders) from (
        select hour(created_at), (count(distinct order_id)) orders
        from stg_postgres__orders
        group by hour(created_at)
        );
--result: 15

3: 
select avg(timestampdiff(hour,created_at, delivered_at)) as avg_delivery_in_hours 
from stg_postgres__orders;
--result_ 93 hours

4:
select count(distinct user_id) 
from (
        select user_id,  count(distinct order_id) as order_count
        from stg_postgres__orders
        group by 1
    )
where order_count = 1;
--result: 1 order:25

select count(distinct user_id)
from (
        select user_id,  count(distinct order_id) as order_count
        from stg_postgres__orders
        group by 1
    )
where order_count = 2;
--result: 2 orders: 28

select count(distinct user_id)
from (
        select user_id,  count(distinct order_id) as order_count
        from stg_postgres__orders
        group by 1
    )
where order_count = 3;
--result: 3 orders: 34

5:
select avg(sessions) from ( 
    select hour(created_at), count(distinct session_id) sessions
    from stg_postgres__events
    group by 1)
;
--result: 39